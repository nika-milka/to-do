name: CI/CD Pipeline

on:
  pull_request:
    branches: [ dev, main ]
  push:
    branches: [ dev, main ]

jobs:
  code-quality:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11"]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install pylint
    
    - name: Check Python files syntax
      run: |
        python -m py_compile $(find . -name "*.py")
      continue-on-error: true
    
    - name: Analysing the code with pylint
      run: |
        find . -name "*.py" | xargs pylint --output-format=text || true
    
    - name: Run basic tests
      run: |
        # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –∑–∞–ø—É—Å–∫–∞–µ–º –∏—Ö
        if [ -f test_*.py ]; then
          for test_file in test_*.py; do
            echo "Running $test_file"
            python $test_file || true
          done
        fi
        echo "Basic validation completed"

  security-scan:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Basic security check
      run: |
        echo "üîç Security scan started"
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        if git log -p | grep -i "password\|secret\|key"; then
          echo "‚ö†Ô∏è  Warning: Possible sensitive data found in commits"
        else
          echo "‚úÖ No obvious sensitive data found"
        fi
